-- 当天交易额Top30钱包数据

-- NFT API数据表结构定义和数据导入

-- 设置执行参数
SET 'execution.checkpointing.interval' = '10s';
SET 'table.exec.state.ttl'= '8640000';
SET 'table.local-time-zone' = 'Asia/Shanghai';

/* 创建Paimon Catalog */
CREATE CATALOG paimon_hive WITH (
    'type' = 'paimon',
    'metastore' = 'hive',
    'uri' = 'thrift://192.168.254.133:9083',
    'hive-conf-dir' = '/opt/software/apache-hive-3.1.3-bin/conf',
    'hadoop-conf-dir' = '/opt/software/hadoop-3.1.3/etc/hadoop',
    'warehouse' = 'hdfs:////user/hive/warehouse'
);

USE CATALOG paimon_hive;
CREATE DATABASE IF NOT EXISTS ods;
USE ods;


-- 当天交易额Top30钱包
CREATE TABLE IF NOT EXISTS ods_daily_top30_volume_wallets (
    rank_date STRING,
    account_address STRING,
    rank_num INT,
    trade_volume DOUBLE,
    trade_volume_usdc DOUBLE,
    trade_count BIGINT,
    is_whale BOOLEAN, 
    created_at TIMESTAMP(3),
    PRIMARY KEY (rank_date, account_address) NOT ENFORCED
) WITH (
    'bucket' = '4',
    'bucket-key' = 'account_address',
    'file.format' = 'parquet',
    'merge-engine' = 'deduplicate',
    'changelog-producer' = 'input',
    'compaction.min.file-num' = '5',
    'compaction.max.file-num' = '50',
    'compaction.target-file-size' = '128MB'
);

-- 插入数据
INSERT INTO ods_daily_top30_volume_wallets (
    rank_date,
    account_address,
    rank_num,
    trade_volume,
    trade_volume_usdc,
    trade_count,
    is_whale,
    created_at
) VALUES
('2025-04-15', '0x29469395eaf6f95920e59f858042f0e28d98a20b', 1, 200.2831, 322503.9527, 46, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x968d74b643e5c398b35c1be3d025bf24c4f4a33a', 2, 127.5, 202534.8875, 2, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x74024eefb813f3334e64c4089cd9e38b731491dc', 3, 76.75, 123218.4025, 3, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x0232d1083e970f0c78f56202b9a666b526fa379f', 4, 65, 102948.95, 1, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0xee956511a3819339b22314ae18f95bb75c3d7160', 5, 62.5, 99585.9375, 1, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x1ea27bce786a81022dfc156059771e8d3279a9a6', 6, 59.174, 95283.8868, 34, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0xcb1dd73c50efe718807ffdf7e6f0306e275bc983', 7, 53.69, 85759.5739, 1, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0xf0d3c4d9045c7ab60aeacc77013e0087b743283c', 8, 53.69, 85759.5739, 1, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0xf76246b0842c92ad5bd745973ca9eb85b937b126', 9, 48.78, 78523.3323, 3, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x88a724a10f2252c8af1d11c7a218359569116a17', 10, 46, 74515.63, 1, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x511432a0ca35ea7a3874290872333b8b719280fc', 11, 45.9649, 73885.7075, 24, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x95fde6cf0d305078b7eeac44182a931c169dd947', 12, 44.8, 72434.88, 1, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x1be7c67b97318cce02328a44beb4985932ad0795', 13, 44.8, 72434.88, 1, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x5b468edb7688e9ae6c1fa5a6d2debbef06e92907', 14, 39.3289, 62295.7384, 5, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0xe6f9b14ae3812176a1fe74ddd082eed4950da447', 15, 35.4857, 56914.8538, 28, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x1992a41693310eb9434b5e3ecb564f4739fcc677', 16, 31.5707, 51184.3909, 11, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x71bfb8e9775ba531c9a4bc25eca6a8ff8a62c336', 17, 30.369, 48149.7458, 2, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x74ab532d6d4b10598591a1ed3a40e97e5feceebb', 18, 30.282, 47998.8247, 5, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x85ee2429e3c483ce575364f63191ce8ac58e1fce', 19, 30.2, 48027.951, 2, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0xdb7f8558f54e8941ce1e03d6555a9737ca93925b', 20, 30.088, 47678.6591, 2, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x2e7573445b46a305f6b80f86ba56e788b2db7e68', 21, 29.85, 47366.0655, 2, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0xdaf517e6079e856456273fff699286848f78d580', 22, 29.34, 46518.2766, 2, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x2c7d898dc074530db08e7fcf8d95257782fd7d77', 23, 29.287, 46434.2456, 2, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x4459084da2d3a774c436f2e75f2e3fe9335dc5de', 24, 29.2323, 47004.7095, 18, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x8a7d2a5fa5912e6feef47c8184d4e4ff56681f0c', 25, 28.91, 46597.8338, 3, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0xa2de7065ae0c9a87b867cc91fb3418cc6f5f1a2b', 26, 27.8959, 45648.7178, 29, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0xac07e26c74562c50a21a25821382ed52cb6e651c', 27, 23.4136, 37690.0043, 6, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x5ae56d13e4684c8cd4d97875ec657c0a14b8b53e', 28, 22.22, 35646.6572, 1, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0xb6b6541df68b35df627beade1ab825b7a7c641e7', 29, 22.025, 35018.6488, 10, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP)),('2025-04-15', '0x87d411bb593218f43b1c76278769a0f5d1b740f4', 30, 21.97, 35406.5225, 3, TRUE, CAST('2025-04-15 14:16:11' AS TIMESTAMP))
;
