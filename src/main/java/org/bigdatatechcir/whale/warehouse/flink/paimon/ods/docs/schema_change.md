# NFT交易表字段重命名说明文档

## 背景

我们对`ods_collection_transaction_inc`表的字段进行了重命名，以更准确地反映NFT交易中各个地址的实际角色和含义。原有字段名容易引起混淆，导致下游数据处理和分析出现错误。

## 字段变更对照表

| 原字段名 | 新字段名 | 含义说明 |
|---------|---------|---------|
| from_address | buyer_address | 区块链交易的发起方/签名者，通常是买家的钱包地址 |
| to_address | marketplace_address | 区块链交易的接收方，通常是NFT市场合约地址 |
| send | from_address | NFT的发送方/卖家地址，表示NFT原所有者 |
| receive | to_address | NFT的接收方/买家地址，表示NFT新所有者 |

## 字段含义详解

### 区块链交易层面
- **buyer_address**（原`from_address`）：区块链交易的实际发起方，签署并支付Gas费用的钱包地址。在NFT交易中，通常是买家发起交易并支付Gas。
- **marketplace_address**（原`to_address`）：区块链交易的目标合约地址，通常是NFT交易市场的智能合约，如OpenSea、X2Y2等平台的合约地址。

### NFT所有权层面
- **from_address**（原`send`）：NFT的原所有者，即卖家的钱包地址，NFT从这个地址转出。
- **to_address**（原`receive`）：NFT的新所有者，即买家的钱包地址，NFT转入这个地址。

## 字段重命名的必要性

在区块链交易中，有两个层面的"发送方"和"接收方"：
1. **区块链交易层面**：谁发起了交易，交易发送到哪个合约
2. **NFT所有权层面**：NFT从谁那里转出，转给了谁

原字段命名混淆了这两个层面，容易导致分析时产生错误。新的命名方式明确区分了这两个层面，使数据结构更加清晰。

## 影响范围

此次字段重命名会影响所有依赖`ods_collection_transaction_inc`表的查询和数据处理逻辑。需要相应更新以下内容：

1. 数据字典文档
2. DWD层数据处理SQL
3. DWS层聚合统计SQL
4. ADS层分析报表SQL
5. 应用层查询和API

## 迁移计划

1. 创建带有新字段结构的临时表
2. 将数据从原表迁移到临时表
3. 验证数据一致性
4. 删除原表并将临时表重命名为原表名

## 注意事项

在确保数据完全迁移成功之前，请勿删除原表。建议在非生产环境中先进行测试，确认所有查询和依赖都已正确更新后，再在生产环境中执行迁移。 