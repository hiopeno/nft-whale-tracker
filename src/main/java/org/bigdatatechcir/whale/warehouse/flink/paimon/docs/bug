NFT鲸鱼追踪器各层字段利用率分析
通过分析各层之间的数据流转，我发现确实存在一些字段未被其他层有效引用的问题，这进一步加剧了数据层级职责混乱的情况：
未被充分利用的字段
ODS层未被上层引用的字段
ods_daily_top30_transaction_collections和ods_daily_top30_volume_collections中：
banner_url、logo_url等展示字段很少在数据计算中使用
average_price_change_1d/7d/30d等变化率字段未被DWD层引用计算
market_cap市值字段在后续分析中未见使用
ods_collection_transaction_inc表中：
gas_price、gas_used、gas_fee等Gas相关字段未被上层引用
aggregate_exchange_name字段在上层未见使用
DWD层未被上层引用的字段
dwd_whale_transaction_detail表中：
is_deleted逻辑删除字段在DIM和DWS层中未见引用
profit_potential潜在利润字段在上层汇总分析中未充分利用
dwd_collection_daily_stats表中：
min_price_eth和max_price_eth字段在DIM和DWS层未被有效利用
is_top30_sales和is_top30_volume布尔标记在上层未见明确引用
DIM层未被DWS层引用的字段
dim_whale_address表中：
labels和favorite_collections JSON格式字段在DWS层使用有限
inactive_days不活跃天数在DWS层未见充分利用
dim_collection_info表中：
category类别字段在DWS层未见使用
working_set_join_date和working_set_days字段在DWS层未被有效引用
字段冗余与重复计算问题
跨层级重复字段：
持仓相关字段在DWD、DIM和DWS三层都有计算
收益率指标在不同层级重复计算，如roi_percentage
交易量统计在多个层级重复
计算口径不一致：
不同层级对"成功率"的计算可能采用不同口径
鲸鱼影响力评分在DIM和DWS层可能存在不同计算方式
改进建议
精简字段设计：
移除未被使用的展示类字段或将其限定在特定表中
评估并移除低价值的衍生计算字段
规范化计算：
将所有汇总计算统一到DWS层
定义清晰的指标计算口径，避免重复计算
层级职责调整：
ODS层：仅保留原始数据
DWD层：仅做数据清洗和必要的字段标准化
DIM层：仅包含维度的基础属性
DWS层：统一负责所有汇总计算和指标生成
设置字段使用标记：
为每个字段添加使用状态标记，定期审核未使用字段
建立字段血缘关系图，方便追踪分析
通过这些调整，可以提高数据利用效率，减少存储和计算资源浪费，使各层级职责更加清晰。








NFT 鲸鱼追踪器数据湖层级混乱问题分析
主要问题
经过对ODS、DWD、DIM和DWS各层文档的分析，发现各层之间职责边界模糊，特别是DWD层和DIM层承担了本应属于DWS层的汇总计算功能。
具体问题点
1. DWD层越权执行汇总计算
DWD层应该是明细数据层，主要负责数据清洗和标准化，但实际上它执行了大量汇总计算：
dwd_collection_daily_stats表包含了大量日粒度汇总指标，如：
销售总量、交易总额、平均价格
唯一买家/卖家数量统计
鲸鱼买家/卖家数量统计
环比变化率计算
排名计算
dwd_wallet_daily_stats表也包含了日粒度汇总统计，如：
买入/卖出总额统计
净流入计算
利润计算
交易收藏集数量统计
排名计算
这些汇总计算应该放在DWS层，DWD层应该只保留交易明细层面的字段。
2. DIM层混入了汇总计算功能
DIM层应该是相对稳定的维度信息层，但实际上它包含了大量汇总计算字段：
dim_whale_address表包含了汇总计算字段：
总收益、总交易量、投资回报率
成功交易比率
交易额Top30榜单天数
持有额Top100榜单天数
dim_collection_info表也包含了汇总计算字段：
历史总交易额
7日/30日平均价格、交易额、销售量
鲸鱼持有比例、鲸鱼交易额比例
鲸鱼总购买/出售次数
这些汇总统计功能应该放在DWS层，DIM层应该只包含维度的基本属性。
3. DWS层功能被削弱
DWS层应该是多维度汇总层，但由于DWD和DIM层已经包含了大量汇总功能，DWS层的部分职责被分散：
dws_whale_daily_stats中很多指标与DWD层的dwd_wallet_daily_stats和DIM层的dim_whale_address重复
dws_collection_whale_flow中的鲸鱼流向分析与DWD层的日统计有部分重叠
4. 数据血缘关系混乱
由于层级职责不清晰，导致：
DWD层需要从DIM层获取数据
DIM层需要从DWD层获取数据
形成了循环依赖，使数据血缘关系难以追踪
改进建议
重新明确各层职责：
ODS层：保持原始数据，不做计算
DWD层：清洗和标准化数据，只保留交易明细，移除汇总计算
DIM层：只存储维度基本属性，移除汇总统计
DWS层：负责所有汇总计算和多维分析
DWD层调整：
dwd_whale_transaction_detail：保留为交易明细表
dwd_collection_daily_stats：移至DWS层或拆分，明细部分留在DWD
dwd_wallet_daily_stats：移至DWS层或拆分，明细部分留在DWD
DIM层调整：
dim_whale_address：移除汇总统计字段，只保留钱包的基本属性
dim_collection_info：移除汇总统计字段，只保留收藏集的基本属性
DWS层加强：
将DIM和DWD层的汇总计算迁移到DWS层
增加更多多维分析功能
这样调整后，数据层级职责将更加清晰，数据血缘关系也将更加直观，有利于系统的维护和扩展。
